#######
# REF #
#######

# References :
# - `man tmux`
# - tmux cheatsheet : https://devhints.io/tmux
# - https://github.com/majutsushi/etc/blob/master/tmux/tmux.conf
# - https://github.com/jtdaugherty/tmux-config/blob/master/tmux.conf
# - https://github.com/sbernheim4/dotfiles/blob/master/.tmux.conf

# Notice :
# - set  === set-option
# - setw === set-window-option

########
# KEYS #
########

# Prefix-Key ( make it easier to press )
## Replace default `ctrl + b` with `ctrl + q`
set -g prefix C-q
unbind C-b

# Make `ctrl + a` Sendable ( to other programs )
bind C-a send-prefix

# Reload Tmux Configs ( make it easy )
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Unbind-Key ( prevent misoperations )
## switch pane
unbind o
## next layout
unbind Space

###########
# SESSION #
###########

# Delay After Pressing ( prefix-key )
## Faster Command Sequences
## Default : 500 millis
# set -sg escape-time 0

# First Index of Windows
## Default : 0
set -g base-index 1

# History Buffer
set -g history-limit 10000

# Mouse Support
# ( WARN: It disable `selection-copy` on iTerm. )
# ( Must press `option` key ( ‚å• ) & select by mouse for `selection-copy`. )
set -g mouse on

# Terminal Color Mode
set -g default-terminal "screen-256color"
# set -sg default-terminal "tmux-256color"

# Complex
## See https://mutelight.org/practical-tmux

##########
# WINDOW #
##########

# First Index of Panes
setw -g pane-base-index 1

## Better Resize : for multiple client connections to same session.
setw -g aggressive-resize on

## testing
set -sg focus-events off
set -g activity-action none
set -g bell-action current
set -g set-titles on
set -g silence-action none
set -g visual-activity on
set -g visual-bell off
set -g visual-silence on
setw -g alternate-screen on # default value
setw -g monitor-activity on
# If this option is set, tmux will generate xterm(1) -style function key sequences; these have a number
#   included to indicate modifiers such as Shift, Alt or Ctrl.

## todo
### options catagories : server / session /

#############
# COPY-MODE #
#############

# Manipulate as vi-mode in copy-mode
setw -g mode-keys vi
# related but
set -g status-keys emacs # default
setw -g xterm-keys on

# Select (v)
bind-key -T copy-mode-vi 'v' send -X begin-selection

# Copy (y)
# bind-key -T copy-mode-vi 'y' send -X copy-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel
bind-key -T copy-mode-vi 'u' send -X copy-selection-and-cancel
bind-key -T copy-mode-vi 'Y' send -X copy-selection-and-cancel
bind-key -T copy-mode-vi 'Y' send -X copy-line
# unbind-key -T copy-mode-vi 'Y'
# 'D' : copy-to-end-of-line

############
# SESSIONS #
############

# Useful
set-option -g renumber-windows on

##############
# STATUS-BAR #
##############

# Move to top
set-option -g status-position top

# Colors
# set -g status-fg red
# set -g status-bg black

# Left
set -g status-left-length 25
# set -g status-left "#[fg=white]Sess.#S Win.#I Pane.#P"
set -g status-left "#[fg=white]#[bg=black] Session #[fg=black]#[bg=green] #S"

# Center
# Move window list at the center
set -g status-justify centre

# Right
set -g status-right-length 25
# set -g status-right "%a %b %d %T"
set -g status-right "%T #[fg=white]#[bg=black] %a %m/%d "

# Refresh per interval
set -g status-interval 1

# Rename windows or panes based on what is currently running in them
setw -g automatic-rename on
setw -g automatic-rename-format "#{pane_current_command}"

# Window Status Format
setw -g window-status-separator ''
setw -g window-status-format " #I.#W "
setw -g window-status-current-format " #I.#W "

# Window Status Style
setw -g window-status-style "fg=default,bg=green"
setw -g window-status-current-style "fg=white,bg=black"
setw -g window-status-bell-style "fg=default,bg=red"
setw -g window-status-activity-style "fg=red,bg=black"

# Window Status Format with Style
# set-window-option -g window-status-format "#[fg=black]#[bg=green] #I.#W "
# set-window-option -g window-status-current-format "##[fg=white]#[bg=black] #I.#W "

########
# PANE #
########

## Select
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

## Resize
bind -r ^y resizep -L 5 # left  (pf, ^h)
bind -r ^u resizep -D 5 # down  (pf, ^j)
bind -r ^i resizep -U 5 # up    (pf, ^k)
bind -r ^o resizep -R 5 # right (pf, ^l)

## Maximize & Minimize
unbind M
bind M new-window -d -n tmp \; swap-pane -s tmp.1 \; select-window -t tmp
unbind m
bind m last-window \; swap-pane -s tmp.1 \; kill-window -t tmp

# WARN: There is a bug for these configs.
# Only available after switching to another app using the mouse!
bind-key    -T copy-mode-vi MouseDown1Pane    select-pane
bind-key    -T copy-mode-vi MouseDrag1Pane    select-pane \; send-keys -X begin-selection
bind-key    -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection
#bind-key    -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind-key    -T copy-mode-vi 'c'               send-keys -X copy-selection

##########
# WINDOW #
##########

## New
bind c new-window -c "#{pane_current_path}"

## Split
bind \ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

###########
# BUG-FIX #
###########

# macOS Clipboard
# ( Configs below must be disabled on other OS )
set-option -g default-command "reattach-to-user-namespace -l ${SHELL}"

########
# TEST #
########

# List of plugins
# Supports `github_username/repo` or full git URLs
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.config/tmux/plugins/"
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'Morantron/tmux-fingers'
# set-option -g @tpm_plugins "    \
#     tmux-plugins/tpm            \
#     tmux-plugins/tmux-logging   \
#     tmux-plugins/tmux-open      \
#     tmux-plugins/tmux-prefix-highlight \
#     Morantron/tmux-fingers      \
# "
set-option -g @open 'O'

set-option -g @prefix_highlight_fg 'black,bold' # default is 'colour231'
set-option -g @prefix_highlight_bg 'green'  # default is 'colour04'
set-option -g @prefix_highlight_show_copy_mode 'on'
set-option -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold'
# set-option -g @prefix_highlight_output_prefix '< '
set-option -g @prefix_highlight_output_suffix ' '

set-option -g @fingers-key 'C-f'
set-option -g @fingers-copy-command 'xclip -selection clipboard'
set-option -g @fingers-hint-format "#[fg=red,bold]%s"
set-option -g @fingers-hint-format-nocompact "#[fg=red,bold][%s]"
set-option -g @fingers-highlight-format "#[fg=yellow,bold,dim]%s"

# Initializes TMUX plugin manager.
# Keep this line at the very bottom of tmux.conf.
run-shell ~/.config/tmux/plugins/tpm/tpm
